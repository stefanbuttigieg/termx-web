<div class="m-items-middle" style="flex-direction: column">
  <m-card>
    <div *m-card-header class="m-justify-between">
      <m-title>{{'web.snomed.branch.list.header' | translate}}</m-title>
      <div class="m-items-middle">
        <tw-add-button [routerLink]="['add']">
          {{'web.snomed.branch.list.add-branch' | translate}}
        </tw-add-button>
      </div>
    </div>
    <m-table [mData]="branches" [mLoading]="loader.isLoading" mEnablePagination>
      <tr *mTableHead>
        <th>{{'entities.snomed-branch.path' | translate}}</th>
        <th>{{'entities.snomed-branch.creation' | translate}}</th>
        <th>{{'entities.snomed-branch.base' | translate}}</th>
        <th>{{'entities.snomed-branch.deleted' | translate}}</th>
      </tr>
      <tr *mTableRow="let branch">
        <td><a [routerLink]="[branch.path | apply:encodeUriComponent, 'management']">{{branch.path}}</a></td>
        <td>{{branch.creation | localDate}}</td>
        <td>{{branch.base | localDate}}</td>
        <td>
          <m-checkbox [ngModel]="branch.deleted" readOnly></m-checkbox>
        </td>
      </tr>
      <tr *mTableNoData>
        <td colspan="100%">
          <m-no-data></m-no-data>
        </td>
      </tr>
    </m-table>
  </m-card>


  <m-card>
    <div *m-card-header class="m-justify-between">
      <m-title>{{'web.snomed.branch.list.codesystem.header' | translate}}</m-title>
      <div class="m-items-middle">
        <tw-add-button *twPrivileged="'snomed-ct.CodeSystem.edit'" (click)="editionModalData.visible = true">
          {{'web.snomed.branch.list.codesystem.add-edition' | translate}}
        </tw-add-button>
      </div>
    </div>
    <m-table [mData]="codeSystems" [mLoading]="loader.isLoading" mEnablePagination>
      <tr *mTableHead>
        <th>{{'entities.snomed-codesystem.short-name' | translate}}</th>
        <th>{{'entities.snomed-codesystem.branch-path' | translate}}</th>
        <th>{{'entities.snomed-codesystem.languages' | translate}}</th>
        <th>{{'entities.snomed-codesystem.latest-version' | translate}}</th>
        <th class="tw-table-min-width" *twPrivileged="'snomed-ct.CodeSystem.edit'"></th>
      </tr>
      <tr *mTableRow="let cs">
        <td>{{cs.shortName}}</td>
        <td>{{cs.branchPath}}</td>
        <td><div *ngFor="let lang of cs.languages | values">{{lang}}</div></td>
        <td>
          <div>{{cs.latestVersion?.version}}</div>
          <div>{{cs.latestVersion?.description}}</div>
        </td>
        <td *twPrivileged="'snomed-ct.CodeSystem.edit'">
          <m-dropdown>
            <a *m-dropdown-item (mClick)="deleteCodeSystem(cs.shortName)">{{'core.btn.delete' | translate}}</a>
          </m-dropdown>
        </td>
      </tr>
      <tr *mTableNoData>
        <td colspan="100%">
          <m-no-data></m-no-data>
        </td>
      </tr>
    </m-table>
  </m-card>
</div>


<m-modal [(mVisible)]="editionModalData.visible" (mClose)="editionModalData = {visible: false}">
  <m-title *mModalHeader>
    {{'web.snomed.branch.list.edition-modal.header' | translate}}
  </m-title>

  <ng-container *mModalContent>
    <form #form="ngForm">
      <m-form-item mName="countryCode" mLabel="web.snomed.branch.list.edition-modal.country-code" required>
        <m-input name="countryCode" [(ngModel)]="editionModalData.countryCode" required/>
      </m-form-item>
    </form>
  </ng-container>

  <div *m-modal-footer class="m-items-middle">
    <m-button mDisplay="text" (click)="editionModalData.visible = false">
      {{'core.btn.cancel' | translate}}
    </m-button>
    <m-button mDisplay="primary" (click)="createCodeSystem()" [mLoading]="loader.isLoading" [disabled]="loader.state['save']">
      {{'core.btn.confirm' | translate}}
    </m-button>
  </div>
</m-modal>
