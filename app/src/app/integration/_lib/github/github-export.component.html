<ng-template #lbl>
  <div class="m-items-middle">
    <m-icon mCode="github"/>
    Export
  </div>
</ng-template>


<div *ngIf="type === 'text'" (click)="openModal()" m-popover [mContent]="!authenticated ? hoverRef: null">
  <ng-container *ngTemplateOutlet="lbl"></ng-container>
</div>

<m-button *ngIf="type === 'button'" [disabled]="!authenticated" (mClick)="openModal()" m-popover [mContent]="!authenticated ? hoverRef: null">
  <ng-container *ngTemplateOutlet="lbl"></ng-container>
</m-button>


<ng-template #hoverRef>
  You have to
  <m-button (click)="authenticate()" *ngIf="!authenticated">
    <m-icon mCode="github" style="margin-right: 0.5rem"></m-icon>
    Authenticate
  </m-button>
  TermX Github App to use this feature
</ng-template>

<m-modal [(mVisible)]="modalVisible" (mClose)="modalVisible = false; resultUrls = []" [mMaskClosable]="false">
  <ng-container *m-modal-header>
    Export '{{title}}' to Github
  </ng-container>
  <ng-container *m-modal-content>
    <m-form-item mLabel="Commit message" required>
      <m-input [(ngModel)]="commitMessage"></m-input>
    </m-form-item>
    Export to repository:
    <m-spinner [mLoading]="loading">
      <div *ngFor="let r of repos" style="margin-left: 1rem">
        <m-icon mCode="branches" style="margin-right: 0.5rem"></m-icon>
        <a (click)="export(r.url)">{{r.name}}</a>
      </div>
    </m-spinner>
    <m-alert mType="info" *ngIf="resultUrls && resultUrls.length > 0" mTitle="Successfully exported">
      <div *ngFor="let url of resultUrls">
        <a [href]="url" target="_blank">{{url}}</a>
      </div>
    </m-alert>
  </ng-container>
</m-modal>
