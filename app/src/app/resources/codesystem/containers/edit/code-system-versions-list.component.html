<m-card class="tw-card-table">
  <div *m-card-header class="tw-card-header">
    <div class="m-card-title">{{'web.code-system.list.versions' | translate}}</div>
    <m-dropdown>
      <ng-template #buttonTemplate>
        <m-button buttonClass="m-language-input-dropdown-button">
          <span>{{'web.code-system-version.list.add-version' | translate}}</span>
          <m-icon code="down" size="10"></m-icon>
        </m-button>
      </ng-template>
      <a *mDropdownItem [routerLink]="['../versions/add']">{{'web.code-system-version.list.add-new-version' | translate}}</a>
      <a *mDropdownItem (click)="duplicateModal.toggleModal({targetCodeSystem: codeSystemId})">{{'web.code-system-version.list.duplicate-version' | translate}}</a>
    </m-dropdown>

  </div>

  <m-table [data]="versions" [loading]="loading" enablePagination hideOnSinglePage>
    <tr *mTableHead>
      <th>{{'web.code-system-version.entity.version' | translate}}</th>
      <th>{{'web.code-system-version.entity.source' | translate}}</th>
      <th>{{'web.code-system-version.entity.release-date' | translate}}</th>
      <th>{{'web.code-system-version.entity.expiration-date' | translate}}</th>
      <th>{{'web.code-system-version.entity.status' | translate}}</th>
      <th class="tw-table-actions"></th>
      <th class="tw-table-actions"></th>
    </tr>

    <tr *mTableRow="let version">
      <td><a [routerLink]="['../versions', version.version, version.status === 'active'? 'view' : 'edit']">{{version.version}}</a></td>
      <td>{{version.source}}</td>
      <td>{{version.releaseDate | localDate}}</td>
      <td>{{version.expirationDate | localDate}}</td>
      <td>{{version.status}}</td>
      <td class="tw-table-actions">
        <a *ngIf="version.status === 'active'" (click)="retireVersion(version)">
          {{'web.publication-status.operations.retire' | translate}}
        </a>
        <a *ngIf="version.status !== 'active'" (click)="activateVersion(version)">
          {{'web.publication-status.operations.activate' | translate}}
        </a>
      </td>
      <td class="tw-table-actions">
        <m-dropdown>
          <ng-template #buttonTemplate>
            <m-button><m-icon [code]="'ellipsis'"></m-icon></m-button>
          </ng-template>
          <a *mDropdownItem (click)="duplicateModal.toggleModal({targetCodeSystem: codeSystemId, sourceCodeSystem: codeSystemId, sourceVersion: version})">
            {{'core.btn.duplicate' | translate}}
          </a>
          <a *mDropdownItem (click)="exportFhirFormatVersion(version.id)">
            {{'web.code-system-version.list.export-fhir' | translate}}
          </a>
        </m-dropdown>
      </td>
    </tr>

    <tr *mTableNoData>
      <td colspan="5">
        <m-no-data></m-no-data>
      </td>
    </tr>
  </m-table>
</m-card>

<twa-code-system-version-duplicate-modal #duplicateModal (duplicated)="loadVersions()"></twa-code-system-version-duplicate-modal>
