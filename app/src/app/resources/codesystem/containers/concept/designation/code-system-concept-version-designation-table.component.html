<m-spinner [mLoading]="loading">
  <m-card class="m-card-inside">
    <div *m-card-header class="m-items-between">
      <div class="m-card-title">
        {{'entities.code-system-entity-version.designations' | translate}}
      </div>

      <m-dropdown>
        <twa-add-button *m-dropdown-container icon="down" placement="right">
          {{'web.code-system-concept-version.designation.add-designation' | translate}}
        </twa-add-button>

        <a *mDropdownItemIf="!viewMode" [routerLink]="['../designations/add']">
          {{'web.code-system-concept-version.designation.add-designation' | translate}}
        </a>
        <a *mDropdownItemIf="!viewMode"
            [routerLink]="['/resources/code-systems/', codeSystemId, 'supplements', 'add']"
            [queryParams]="{targetType: 'Designation', conceptVersionId: conceptVersionId}"
        >
          {{'web.code-system-concept-version.designation.add-supplement' | translate}}
        </a>
      </m-dropdown>
    </div>

    <m-table [mData]="designationMap | keys" mEnablePagination mHideOnSinglePage>
      <tr *mTableHead>
        <th class="tw-table-min-width">{{'entities.designation.type' | translate}}</th>
        <th>{{'entities.designation.name' | translate}}</th>
        <th>{{'entities.designation.language' | translate}}</th>
        <th></th>
        <th>{{'entities.designation.status' | translate}}</th>
        <th class="tw-table-actions"></th>
      </tr>

      <ng-container *mTableRow="let key;">
        <tr *ngFor="let designation of designationMap[key]; let isFirst = first; let index = index">
          <td *ngIf="isFirst" class="tw-table-min-width" [rowSpan]="designationMap[key].length">{{entityProperties?.[designation.designationTypeId]?.name}}</td>
          <td>
            <a *ngIf="!viewMode"
                [routerLink]="designation.supplementId? ['/resources/code-systems/', codeSystemId, 'supplements', designation.supplementId, 'edit'] : ['../designations/', designation.id, 'edit']"
                [queryParams]="{conceptVersionId: conceptVersionId}"
            >
              <m-abbreviate [mValue]="designation.name" [mLength]="35"></m-abbreviate>
            </a>
            <div *ngIf="viewMode">
              <m-abbreviate [mValue]="designation.name" [mLength]="35"></m-abbreviate>
            </div>
          </td>
          <td>{{designation.language | localizedConceptName: {valueSet: 'languages'} | async}}</td>
          <td class="tw-table-min-width">
            <m-icon *ngIf="designation.supplementId" [mCode]="'block'"></m-icon> <!--todo better icon for supplement-->
          </td>
          <td class="tw-table-min-width">
            <twa-status-tag [status]="designation.status"></twa-status-tag>
          </td>
          <td class="tw-table-actions">
            <m-button mDisplay="text" mShape="circle" *ngIf="!viewMode" (click)="designation.preferred = !designation.preferred">
              <m-icon [mOptions]="{nzTheme : designation.preferred? 'fill' : 'outline'}" [mCode]="'star'"></m-icon>
            </m-button>
            <m-dropdown *ngIf="!viewMode">
              <a *m-dropdown-item (click)="deleteDesignation(key, index)">
                {{'web.code-system-concept-version.designation.delete-designation' | translate}}
              </a>
            </m-dropdown>
            <m-icon *ngIf="viewMode" [mOptions]="{nzTheme : designation.preferred? 'fill' : 'outline'}" [mCode]="'star'"></m-icon>
          </td>
        </tr>
      </ng-container>

      <tr *mTableNoData>
        <td colspan="6">
          <m-no-data></m-no-data>
        </td>
      </tr>
    </m-table>
  </m-card>
</m-spinner>
