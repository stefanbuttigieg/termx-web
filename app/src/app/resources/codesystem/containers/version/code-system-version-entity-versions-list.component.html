<m-card class="m-card-inside">
  <div *m-card-header class="m-items-between">
    <div class="m-card-title">{{'entities.code-system-version.entities' | translate}}</div>
    <twa-add-button (click)="modalVisible = true" *ngIf="!viewMode">
      {{'web.code-system-version.form.entities.add-entity' | translate}}
    </twa-add-button>
  </div>
  <m-input [(ngModel)]="searchInput" (mChange)="searchUpdate.next($event)" placeholder="marina.ui.inputs.search.placeholder"></m-input>

  <m-backend-table [mResult]="searchResult"
      [(mQuery)]="query"
      (mQueryChange)="loadData()"
      [mLoading]="isLoading"
      mSize="small"
      style="margin-top: 1rem; display: block"
  >
    <tr *mTableHead>
      <th>{{'web.code-system-version.form.entities.entity-version' | translate}}</th>
      <th>{{'entities.code-system-entity-version.created' | translate}}</th>
      <th class="tw-table-min-width">{{'entities.code-system-entity-version.status' | translate}}</th>
      <th class="tw-table-actions" *ngIf="!viewMode"></th>
    </tr>

    <tr *mTableRow="let entityVersion">
      <td>{{entityVersion.code}} {{entityVersion.id | localizedConceptName: {codeSystem: codeSystemId} | async}}</td>
      <td>{{entityVersion.created | localDate}}</td>
      <td class="tw-table-min-width"><twa-status-tag [status]="entityVersion.status"></twa-status-tag></td>
      <td class="tw-table-actions" *ngIf="!viewMode">
        <m-dropdown>
          <a *m-dropdown-item (click)="delete(entityVersion)">
            {{'core.btn.delete' | translate}}
          </a>
        </m-dropdown>
      </td>
    </tr>

    <tr *mTableNoData>
      <td [colSpan]="viewMode ? 2 : 3">
        <m-no-data></m-no-data>
      </td>
    </tr>
  </m-backend-table>
</m-card>

<m-modal [(mVisible)]="modalVisible" (mClose)="modalVisible = false; modalData = undefined">
  <ng-container *m-modal-header>
    {{'web.code-system-version.form.entities.modal.add-header' | translate}}
  </ng-container>

  <ng-container *m-modal-content>
    <form #form="ngForm">
      <m-form-item mName="modalData" mLabel="entities.code-system-version.form.entities.modal.entity-version" required>
        <twl-code-system-entity-version-search name="modalData"
            [(ngModel)]="modalData"
            [codeSystemId]="codeSystemId"
            required
        ></twl-code-system-entity-version-search>
      </m-form-item>
    </form>
  </ng-container>

  <ng-container *m-modal-footer>
    <m-button mDisplay="text" mStyle="margin-right: 0.5em" [disabled]="isLoading" (click)="modalVisible = false">{{'core.btn.close' | translate}}</m-button>
    <m-button mDisplay="primary" [disabled]="isLoading" [mLoading]="isLoading" (click)="save()">{{'core.btn.add' | translate}}</m-button>
  </ng-container>
</m-modal>
