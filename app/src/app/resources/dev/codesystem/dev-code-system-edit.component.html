<div nz-row nzJustify="center">
  <div nz-col [nzLg]="18" [nzXs]="24">
    <m-spinner [mLoading]="loading['save']">
      <m-card [mTitle]="mode === 'edit' ? 'web.code-system.form.edit-header' : 'web.code-system.form.add-header'" [mShowSkeleton]="loading['init']" autofocus>
        <form #form="ngForm" *ngIf="codeSystem">
          <m-form-item mLabel="entities.code-system.name">
            <m-multi-language-input name="name" [(ngModel)]="codeSystem.names" (ngModelChange)="nameChanged($event)"></m-multi-language-input>
          </m-form-item>

          <m-form-item mName="id" mLabel="entities.code-system.id" required>
            <m-input name="id" [(ngModel)]="codeSystem.id" [disabled]="mode === 'edit'" required></m-input>
          </m-form-item>

          <m-form-item mName="source" mLabel="entities.code-system-version.source">
            <twl-value-set-concept-select name="source" [(ngModel)]="codeSystem.versions[0].source" (ngModelChange)="publisherChanged($event)" valueSet="publisher" required></twl-value-set-concept-select>
          </m-form-item>

          <m-form-item mName="uri" mLabel="entities.code-system.uri" required>
            <div class="m-items-middle">
              <m-input style="width: 100%" name="uri" [(ngModel)]="codeSystem.uri" required></m-input>
              <a *ngIf="codeSystem.uri | validateUrl" [href]="codeSystem.uri" target="_blank">
                <m-button>
                  <m-icon mCode="eye"></m-icon>
                </m-button>
              </a>
            </div>
          </m-form-item>

          <m-form-item mName="baseCodeSystem" mLabel="entities.code-system.base-code-system">
            <twl-code-system-search name="baseCodeSystem" [(ngModel)]="codeSystem.baseCodeSystem" valuePrimitive></twl-code-system-search>
          </m-form-item>

          <m-form-item mName="description" mLabel="entities.code-system.description">
            <m-textarea name="description" [(ngModel)]="codeSystem.description"></m-textarea>
          </m-form-item>

          <twa-dev-cs-properties #propertiesComponent [codeSystemId]="codeSystemId"></twa-dev-cs-properties>

          <twa-dev-cs-relations #relationsComponent [codeSystemId]="codeSystemId" [currentCodeSystemId]="codeSystem.id"></twa-dev-cs-relations>
        </form>

        <ng-container *m-card-footer>
          <m-button mDisplay="primary" [mLoading]="loading['save']" [disabled]="loading['save'] || loading['init']" (click)="save()">
            {{'core.btn.save' | translate}}
          </m-button>
        </ng-container>
      </m-card>
    </m-spinner>
  </div>
</div>
