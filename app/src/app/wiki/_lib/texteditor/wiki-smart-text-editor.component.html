<tw-smart-text-editor-view *ngIf="viewMode; else edit" [value]="value" [valueType]="valueType"/>


<ng-template #edit>
  <tw-dropdown-menu
    #optionMenu
      [containerRef]="ref"
      [lang]="lang"
      (resultComposed)="insertAtRange($event.result, $event.range, $event.cursorOffset)"
  />

  <div class="editor-wrapper">
    <div #ref class="editor__editor">
      <ng-container *ngIf="valueType === 'markdown'">
        <tw-wiki-textarea
            style="font-family: monospace"
            [(ngModel)]="value"
            (ngModelChange)="fireOnChange($event)"
            (click)="optionMenu.hide()"
            (keydown)="optionMenu.handleKeyDown($event)"
            (keyup)="optionMenu.handleKeyUp($event)"
            (blur)="onTouched()"
            (mouseleave)="updateCursorPosition()"
        />
      </ng-container>

      <ng-container *ngIf="valueType === 'html'">
        <m-quill
            [(ngModel)]="value"
            (click)="optionMenu.hide()"
            (keydown)="optionMenu.handleKeyDown($event)"
            (keyup)="optionMenu.handleKeyUp($event)"
            (blur)="onTouched()"
            (ngModelChange)="fireOnChange($event)"
        />
      </ng-container>
    </div>


    <div *ngIf="showPreview" class="editor__preview">
      <tw-smart-text-editor-view [value]="valueView$ | async" [valueType]="valueType" [prerender]="true"/>
    </div>
  </div>
</ng-template>
